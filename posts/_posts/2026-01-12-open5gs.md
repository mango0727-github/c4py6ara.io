---
layout: post
title: Cellular network simulation: Open5GS and UERANSIM
description: >
  This post covers details on Open5GS and UERANSIM configurations and related 5GC and RAN network architecture. For installation procedures for Open5GS and UERANSIM, you can look around some other various posts and Youtube contents, and most importantly vendor-provided manuals. In this post, AMF, one of cellular network functions is mainly covered.
sitemap: false
math: true
hide_last_modified: true
---

## Before reading

Open5GS is a widely used open-source implementation of 5G core network functions. While major cellular vendors naturally rely on proprietary testbeds, Open5GS fills a different—and increasingly important—gap: it offers researchers and security practitioners a practical, modifiable 5G core that can be deployed on commodity hardware.

There is no shortage of installation guides for Open5GS and UERANSIM. However, many of them stop right after “it works.” This post takes a different approach. I will walk through the key configuration parameters (especially those in AMF/SMF/UPF) and explain what each of them means in terms of the actual 5G architecture and interfaces (SBI, NGAP/N2, GTP-U/N3, and beyond). The goal is to help you understand not only how to run a 5G core, but also why specific settings matter—so you can debug failures faster and reason about security and design trade-offs more confidently.

Therefore, this post targets a different pain point:

> “I can run it, but I don’t understand why these YAML knobs exist, and how they map to actual 5G architecture and 3GPP interfaces.”

So we will:

- Connect **UE.yaml**, **gnb.yaml**, **amf.yaml** to the **3GPP reference points** (N1/N2/N3) and the **Service-Based Architecture (SBA)**.
- Walk through the **registration + authentication + PDU session** flow and show which config fields are actually “in play”.
- Explain the meaning of “multiple IPs” you might see (e.g., `127.0.0.1` vs `127.0.0.5`, or `10.45.0.1`) and how to validate what is really binding where.

Assumption: you are running a single-host lab where Open5GS core, UERANSIM gNB, and UERANSIM UE run either on the same VM or in the same L2 domain.

---

## Architectural primer: the minimum you must hold in your head

### The 5G reference points you’ll actually observe in a lab (TS 23.501)

3GPP defines key reference points like this:

- **N1**: UE ↔ AMF  
- **N2**: (R)AN ↔ AMF  
- **N3**: (R)AN ↔ UPF  

In your lab, that becomes:

- **N1 = NAS messages** (Registration Request, Authentication Response, Security Mode Complete, etc.). These are carried inside the access network control plane.
- **N2 = NGAP over SCTP** (gNB ↔ AMF), where NAS is transported to the core.
- **N3 = GTP-U user plane** (gNB ↔ UPF), for actual IP traffic after a PDU session is established.

### What “SBA” means in practice (TS 23.501 / TS 29.518)

In 5GC, many control-plane interactions are HTTP-based “services” (SBA). AMF exposes services under **Namf**, with Stage-3 details in **TS 29.518**.

In Open5GS config, that shows up as:

- `amf.sbi.server`: where AMF exposes HTTP APIs
- `amf.sbi.client`: where AMF reaches other NF services (NRF/SCP/etc.)

---

## Addressing in a lab: why you see `127.0.0.x` everywhere

### Loopback aliases (`127.0.0.5`, `127.0.0.10`, …)

Many Open5GS labs bind different NFs to different loopback aliases so everything runs on one host but still looks like “multiple NF endpoints”.

Example mapping you might see:

- AMF on `127.0.0.5`
- NRF on `127.0.0.10`
- SCP on `127.0.0.200`

This is not “real operator addressing”; it is a convenient single-host emulation.

### What about `10.45.0.1` showing a WebUI?

If you see WebUI reachable on both `127.0.0.1` and `10.45.0.1`, the most common cause is:

- WebUI is binding to `0.0.0.0` (all interfaces), and
- `10.45.0.1` is a virtual interface / bridge / container network gateway on your host or VM. (추측)

Validate with:

```bash
ip -br addr
ip route
sudo ss -ltnp | grep -E ':(3000|9999)\b'
