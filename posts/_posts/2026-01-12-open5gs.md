---
layout: post
title: Cellular network simulation--Open5GS and UERANSIM
description: >
  This post covers details on Open5GS and UERANSIM configurations and related 5GC and RAN network architecture. For installation procedures for Open5GS and UERANSIM, you can look around some other various posts and Youtube contents, and most importantly vendor-provided manuals. In this post, AMF, one of cellular network functions is mainly covered.
sitemap: false
math: true
hide_last_modified: true
---

# Cellular network simulation--Open5GS and UERANSIM

## Before reading

Open5GS is a widely used open-source implementation of 5G core network functions. While major cellular vendors naturally rely on proprietary testbeds, Open5GS fills a different—and increasingly important—gap: it offers researchers and security practitioners a practical, modifiable 5G core that can be deployed on commodity hardware.

There is no shortage of installation guides for Open5GS and UERANSIM. However, many of them stop right after “it works.” This post takes a different approach. I will walk through the key configuration parameters (especially those in AMF/SMF/UPF) and explain what each of them means in terms of the actual 5G architecture and interfaces (SBI, NGAP/N2, GTP-U/N3, and beyond). The goal is to help you understand not only how to run a 5G core, but also why specific settings matter—so you can debug failures faster and reason about security and design trade-offs more confidently.

Therefore, this post targets a different pain point:

> “I can run it, but I don’t understand why these YAML knobs exist, and how they map to actual 5G architecture and 3GPP interfaces.”

So we will:

- Connect UE.yaml, gNodeB.yaml, AMF.yaml to the 3GPP reference points (N1/N2/N3) and the Service-Based Architecture (SBA).
- Walk through the registration, authentication, and PDU session flow and show which config fields are actually working.
- Explain the meaning of multiple IPs you might see (e.g., `127.0.0.1` vs `127.0.0.5`, or `10.45.0.1`) and how to validate what is really binding where.

Assumption: you are running a single-host lab where Open5GS core, UERANSIM gNB, and UERANSIM UE run either on the same VM or in the same L2 domain.

---

## Prerequisites

### The 5G reference points you’ll actually observe in a lab (TS 23.501)

3GPP defines key reference points like this:

- N1: UE ↔ AMF  
- N2: RAN ↔ AMF  
- N3: RAN ↔ UPF  

In this lab, N1, N2, and N3 become:

- N1: NAS messages (Registration Request, Authentication Response, Security Mode Complete, etc.). These are carried inside the access network control plane.
- N2: NGAP over SCTP (gNodeB ↔ AMF), where NAS is transported to the core.
- N3: GTP-U user plane (gNodeB ↔ UPF), for actual IP traffic after a PDU session is established.

### What SBA means in practice (TS 23.501 / TS 29.518)

In 5GC, many control-plane interactions are HTTP-based services (SBA). AMF exposes services under NAMF, with Stage-3 details in TS 29.518.

In Open5GS config, that shows up as:

- `amf.sbi.server`: where AMF exposes HTTP APIs
- `amf.sbi.client`: where AMF reaches other NF services such as NRF, SCP, etc.

---

### What does `127.0.0.x` mean?

#### Loopback aliases (`127.0.0.5`, `127.0.0.10`, …)

Many Open5GS labs bind different NFs to different loopback aliases so everything runs on one host but still looks like multiple NF endpoints.

Example mapping you might see:

- AMF on `127.0.0.5`
- NRF on `127.0.0.10`
- SCP on `127.0.0.200`

This is not real operator addressing, however it is a convenient single-host emulation.

---

## Three configuration files to be covered

In this lab, I will touch three YAML files:

- `UE.yaml` (UERANSIM UE): defines subscriber identity, authentication material, and what session or slice the UE requests
- `gNodeB.yaml` (UERANSIM gNB): defines cell identity, where to reach AMF over N2 (NGAP), where to bind N3 (GTP-U)
- `AMF.yaml` (Open5GS AMF): defines where AMF listens for N2, where AMF exposes SBI, which slice it serves and security preferences

A useful concept model is to map them to interfaces first, then to procedures as follows:

| Interface | Protocol (common) | Direction | Where configured |
|---|---|---|---|
| N1 | NAS (inside RAN control plane) | UE ↔ AMF | UE.yaml, AMF.yaml |
| N2 | NGAP over SCTP | gNB ↔ AMF | gNodeB.yaml, AMF.yaml |
| N3 | GTP-U over UDP | gNB ↔ UPF | gNodeB.yaml, UPF.yaml |
| SBA | HTTP/2 or HTTP | NF ↔ NF | AMF.yaml, NRF/SCP configs |

For this post, I will go deep on UE.yaml, gNodeB.yaml, AMF.yaml and show how they drive:
1. Registration  
2. Authentication and NAS security  
3. (Bridge to) PDU Session establishment and user plane considerations

---

## UE.yaml (UERANSIM UE): Who am I, and what do I want?

THIS POST IS UNDER CONSTRUCTION
